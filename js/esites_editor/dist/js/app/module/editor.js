define(["codemirror/lib/codemirror","../var/plugin","../var/targets","../var/deps","./dialog","./util","./code","./standalone"],function(CodeMirror,plugin,targets,deps,dialog,util,code,standalone){"use strict";var editor={};editor.instances=[];editor.options=null;editor.init=function(){util.forEach(targets,editor.createInstance);"undefined"!=typeof varienGlobalEvents&&varienGlobalEvents.attachEventHandler("showTab",function(){util.forEach(editor.instances,function(cm){cm.refresh()})});editor.instances.length&&editor.instances[0].focus()};editor.createInstance=function(textarea){var cm=CodeMirror.fromTextArea(textarea,editor.options);dialog&&dialog.prepare(cm);plugin.settings.emmet&&editor.initEmmet();editor.isStandAlone()&&"undefined"==typeof tinyMCE&&standalone.init(cm,editor);plugin.instances.push(cm);editor.instances.push(cm)};editor.syncValue=function(cm){cm.getTextArea().value=cm.getValue()};editor.initEmmet=function(cm){requirejs(["emmet"],function(emmetCodeMirror){cm?emmetCodeMirror(cm):util.forEach(editor.instances,function(c){emmetCodeMirror(c)})})};editor.isStandAlone=function(){return-1!==util.inArray("wysiwygtemplate_text",plugin.settings.sections)};editor.insertVariable=function(obj,cm){var attr=obj.getAttribute("onclick"),val=attr.match(/{{(.*?)[\|\|.*?]?}}/)[0],doc=cm.getDoc(),cursor=doc.getCursor();doc.replaceRange(val,cursor)};editor.insertSnippet=function(snippet,cm,cursor){var doc=cm.getDoc();doc.replaceRange(snippet,cursor)};return editor});